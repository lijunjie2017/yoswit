// handle read and write topic response window.deviceStatus = [] // local value window.controller_bacnet_subscribe_receive = function (data) { var payload = {}; try { payload = JSON.parse(data.message); } catch (e) { l("controller_bacnet_subscribe_receive", "[MQTT] skip string message: " + data.payloadString); return; } var deviceCode = "" var tagCode = "" var tagCodeValue = "" if (data.topic == "innocell-bms-read-response") { deviceCode = Object.keys(payload)[0]; tagCode = Object.keys(payload[deviceCode])[0] tagCodeValue = payload[deviceCode][tagCode]; } else if (data.topic == "innocell-bms-write-response") { deviceCode = payload.deviceCode tagCode = payload.tagCode tagCodeValue = payload.value } if (deviceCode.length > 0 && tagCode.length > 0) { var key = deviceCode + "." + tagCode deviceStatus[key] = tagCodeValue var elements = document.querySelectorAll("[config^=\"" + key + "\"]") for (i = 0; i < elements.length; i++) { var element = elements[i] if (tagCodeValue == element.getAttribute('button-signal')) { if (element.firstElementChild.textContent == "OFF") { element.firstElementChild.style.backgroundColor = "#ff3b30" element.firstElementChild.style.borderColor = "#ff3b30" element.firstElementChild.style.color = "#ffffff" } else if (element.firstElementChild.textContent == "SCENE 1") { element.firstElementChild.style.backgroundColor = "rgba(255,204,0,0.25)" element.firstElementChild.style.borderColor = "rgba(255,204,0,0.25)" element.firstElementChild.style.color = "#8e8d93" } else if (element.firstElementChild.textContent == "SCENE 2") { element.firstElementChild.style.backgroundColor = "rgba(255,204,0,0.5)" element.firstElementChild.style.borderColor = "rgba(255,204,0,0.5)" element.firstElementChild.style.color = "#8e8d93" } else if (element.firstElementChild.textContent == "SCENE 3") { element.firstElementChild.style.backgroundColor = "rgba(255,204,0,0.75)" element.firstElementChild.style.borderColor = "rgba(255,204,0,0.75)" element.firstElementChild.style.color = "#8e8d93" } else if (element.firstElementChild.textContent == "COOL" || element.firstElementChild.textContent == "MED" || element.firstElementChild.textContent == "HIGH") { element.firstElementChild.style.backgroundColor = "#2196f3" element.firstElementChild.style.borderColor = "#2196f3" element.firstElementChild.style.color = "#ffffff" } else { element.firstElementChild.style.backgroundColor = "#459e44" element.firstElementChild.style.borderColor = "#459e44" element.firstElementChild.style.color = "#ffffff" } } else { element.firstElementChild.style.backgroundColor = "var(--f7-block-strong-bg-color)" element.firstElementChild.style.color = "#8e8d93" element.firstElementChild.style.borderColor = "#8e8d93" } } } } 